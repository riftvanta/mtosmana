(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{283:(e,a,t)=>{"use strict";t.d(a,{A:()=>i,AuthProvider:()=>l,N:()=>c});var r=t(5155),s=t(2115),n=t(9323);let o=(0,s.createContext)(void 0),i=()=>{let e=(0,s.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/login",a=i();return(0,s.useEffect)(()=>{a.loading||a.user||(window.location.href=e)},[a.loading,a.user,e]),a},l=e=>{let{children:a}=e,[t,i]=(0,s.useState)(null),[c,l]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=async()=>{try{await (0,n.r1)()}catch(e){console.error("Error initializing app:",e)}},a=async()=>{try{let e=localStorage.getItem("auth_user");if(e){let a=JSON.parse(e);a.id&&a.username&&a.role?i(a):localStorage.removeItem("auth_user")}}catch(e){console.error("Error checking auth:",e),localStorage.removeItem("auth_user")}finally{l(!1)}};(async()=>{await e(),await a()})()},[]);let d=async e=>{try{l(!0);let a=await (0,n.$u)(e);if(a)return i(a),localStorage.setItem("auth_user",JSON.stringify(a)),!0;return!1}catch(e){return console.error("Login error:",e),localStorage.removeItem("auth_user"),i(null),!1}finally{l(!1)}},u=async()=>{try{i(null),localStorage.removeItem("auth_user")}catch(e){console.error("Logout error:",e)}};return(0,r.jsx)(o.Provider,{value:{user:t,loading:c,login:d,logout:u},children:a})}},347:()=>{},2595:(e,a,t)=>{Promise.resolve().then(t.t.bind(t,8346,23)),Promise.resolve().then(t.t.bind(t,347,23)),Promise.resolve().then(t.bind(t,5843)),Promise.resolve().then(t.bind(t,283))},5843:(e,a,t)=>{"use strict";t.d(a,{default:()=>o});var r=t(5155),s=t(2115),n=t(283);function o(){let{user:e,loading:a}=(0,n.A)(),[t,o]=(0,s.useState)(!1),[i,c]=(0,s.useState)("checking");return((0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("https://firestore.googleapis.com/v1/projects/mtosmana/databases/(default)/documents/test");e.ok||404===e.status?c("connected"):c("permission-denied")}catch(e){c("connection-error")}})()},[]),t)?(0,r.jsxs)("div",{className:"fixed bottom-4 right-4 bg-white border border-gray-300 rounded-lg shadow-lg p-4 max-w-sm z-50",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:"Debug Info"}),(0,r.jsx)("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Auth Status:"}),(0,r.jsx)("span",{className:"ml-2 ".concat(a?"text-yellow-600":e?"text-green-600":"text-red-600"),children:a?"Loading...":e?"Authenticated":"Not Authenticated"})]}),e&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"User:"}),(0,r.jsx)("span",{className:"ml-2 text-gray-700",children:e.username})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Role:"}),(0,r.jsx)("span",{className:"ml-2 text-gray-700 capitalize",children:e.role})]}),e.exchangeName&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Exchange:"}),(0,r.jsx)("span",{className:"ml-2 text-gray-700",children:e.exchangeName})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"Firebase:"}),(0,r.jsx)("span",{className:"ml-2 ".concat((()=>{switch(i){case"connected":return"text-green-600";case"permission-denied":case"connection-error":return"text-red-600";default:return"text-yellow-600"}})()),children:(()=>{switch(i){case"connected":return"Firebase Connected";case"permission-denied":return"Firebase Permission Denied (Security Rules)";case"connection-error":return"Firebase Connection Error";default:return"Checking Firebase..."}})()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium",children:"LocalStorage:"}),(0,r.jsx)("span",{className:"ml-2 text-gray-700",children:localStorage.getItem("auth_user")?"Has stored user":"Empty"})]}),(0,r.jsxs)("div",{className:"pt-2 space-y-2",children:[(0,r.jsx)("button",{onClick:()=>{localStorage.removeItem("auth_user"),window.location.reload()},className:"w-full bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700",children:"Clear Auth & Reload"}),"permission-denied"===i&&(0,r.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-2",children:(0,r.jsxs)("p",{className:"text-xs text-yellow-800",children:[(0,r.jsx)("strong",{children:"Fix:"})," Deploy Firebase security rules from ",(0,r.jsx)("code",{children:"firestore.rules"})]})})]})]})]}):(0,r.jsx)("button",{onClick:()=>o(!0),className:"fixed bottom-4 right-4 bg-gray-800 text-white px-3 py-2 rounded-lg text-sm opacity-50 hover:opacity-100 transition-opacity",children:"Debug Info"})}},6104:(e,a,t)=>{"use strict";t.d(a,{db:()=>c});var r=t(3915),s=t(5317),n=t(858),o=t(6864);let i=(0,r.Wp)({apiKey:"AIzaSyDT2ucPBS2vS_YwxEoZd-bDAhXqj9Dz_j8",authDomain:"mtosmana.firebaseapp.com",projectId:"mtosmana",storageBucket:"mtosmana.firebasestorage.app",messagingSenderId:"77387574915",appId:"1:77387574915:web:7b6855e73ec15269d935b6",measurementId:"G-110ZTYS339"}),c=(0,s.aU)(i);(0,n.c7)(i);(0,o.TT)().then(e=>{e&&(0,o.P5)(i)})},8346:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_e8ce0c"}},9323:(e,a,t)=>{"use strict";t.d(a,{$u:()=>g,dT:()=>x,r1:()=>h});var r=t(9980),s=t(6104),n=t(5317);let o=async e=>await r.Ay.hash(e,12),i=async(e,a)=>await r.Ay.compare(e,a),c=e=>/^[a-zA-Z0-9_-]{3,50}$/.test(e),l=e=>e.length>=6,d=async()=>{try{let e=(0,n.rJ)(s.db,"test");return await (0,n.GG)(e),!0}catch(e){return console.warn("Firebase not accessible:",e),!1}},u=async e=>{let{username:a,password:t}=e;return"admin"===a&&"admin123"===t?{id:"demo-admin-id",username:"admin",role:"admin"}:"exchange1"===a&&"exchange123"===t?{id:"demo-exchange-id",username:"exchange1",role:"exchange",exchangeName:"Demo Exchange Office"}:null},m=async e=>{try{var a,t;let r=(0,n.rJ)(s.db,"users"),o=(0,n.P)(r,(0,n._M)("username","==",e)),i=await (0,n.GG)(o);if(i.empty)return null;let c=i.docs[0],l=c.data();return{id:c.id,username:l.username,password:l.password,role:l.role,exchangeName:l.exchangeName,contactInfo:l.contactInfo,balance:l.balance||0,commissionRates:l.commissionRates||{incoming:0,outgoing:0},assignedBanks:l.assignedBanks||[],status:l.status||"active",createdAt:(null==(a=l.createdAt)?void 0:a.toDate())||new Date,updatedAt:(null==(t=l.updatedAt)?void 0:t.toDate())||new Date}}catch(e){return console.error("Error finding user:",e),null}},h=async()=>{try{if(!await d())return console.log("Firebase not accessible, skipping admin creation"),!0;if(await m("admin"))return!0;let e=await o("admin123"),a={username:"admin",password:e,role:"admin",balance:0,commissionRates:{incoming:0,outgoing:0},assignedBanks:[],status:"active",createdAt:n.Dc.now(),updatedAt:n.Dc.now()};return await (0,n.gS)((0,n.rJ)(s.db,"users"),a),console.log("Default admin user created"),!0}catch(e){return console.error("Error creating default admin:",e),!0}},g=async e=>{try{let{username:a,password:t}=e;if(!c(a)||!l(t))return null;if(!await d())return console.warn("Firebase not accessible, using fallback authentication"),await u(e);let r=await m(a);if(!r||"active"!==r.status||!await i(t,r.password))return null;return{id:r.id,username:r.username,role:r.role,exchangeName:r.exchangeName}}catch(a){return console.error("Authentication error:",a),console.warn("Falling back to demo authentication"),await u(e)}},x=async e=>{try{if(!await d())return console.warn("Firebase not accessible, cannot create exchange user"),!1;if(!c(e.username)||!l(e.password)||await m(e.username))return!1;let a=await o(e.password),t={username:e.username,password:a,role:"exchange",exchangeName:e.exchangeName,balance:e.balance||0,commissionRates:e.commissionRates||{incoming:0,outgoing:0},assignedBanks:[],status:"active",createdAt:n.Dc.now(),updatedAt:n.Dc.now()};return await (0,n.gS)((0,n.rJ)(s.db,"users"),t),!0}catch(e){return console.error("Error creating exchange user:",e),!1}}},9825:()=>{}},e=>{var a=a=>e(e.s=a);e.O(0,[838,992,865,441,684,358],()=>a(2595)),_N_E=e.O()}]);