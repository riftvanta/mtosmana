(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{283:(e,a,t)=>{"use strict";t.d(a,{A:()=>o,AuthProvider:()=>l,N:()=>c});var r=t(5155),n=t(2115),s=t(9323);let i=(0,n.createContext)(void 0),o=()=>{let e=(0,n.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/login",a=o();return(0,n.useEffect)(()=>{a.loading||a.user||(window.location.href=e)},[a.loading,a.user,e]),a},l=e=>{let{children:a}=e,[t,o]=(0,n.useState)(null),[c,l]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=async()=>{try{await (0,s.r1)()}catch(e){console.error("Error initializing app:",e)}},a=async()=>{try{let e=localStorage.getItem("auth_user");if(e){let a=JSON.parse(e);a.id&&a.username&&a.role?o(a):localStorage.removeItem("auth_user")}}catch(e){console.error("Error checking auth:",e),localStorage.removeItem("auth_user")}finally{l(!1)}};(async()=>{await e(),await a()})()},[]);let u=async e=>{try{l(!0);let a=await (0,s.$u)(e);if(a)return o(a),localStorage.setItem("auth_user",JSON.stringify(a)),!0;return!1}catch(e){return console.error("Login error:",e),localStorage.removeItem("auth_user"),o(null),!1}finally{l(!1)}},d=async()=>{try{o(null),localStorage.removeItem("auth_user")}catch(e){console.error("Logout error:",e)}};return(0,r.jsx)(i.Provider,{value:{user:t,loading:c,login:u,logout:d},children:a})}},2261:(e,a,t)=>{Promise.resolve().then(t.bind(t,3792))},3792:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>i});var r=t(5155),n=t(283),s=t(2115);function i(){let{user:e,loading:a}=(0,n.A)();return(0,s.useEffect)(()=>{a||(e?window.location.href="/dashboard":window.location.href="/login")},[e,a]),(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Transfer System"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})})}},6104:(e,a,t)=>{"use strict";t.d(a,{db:()=>c});var r=t(3915),n=t(5317),s=t(858),i=t(6864);let o=(0,r.Wp)({apiKey:"AIzaSyDT2ucPBS2vS_YwxEoZd-bDAhXqj9Dz_j8",authDomain:"mtosmana.firebaseapp.com",projectId:"mtosmana",storageBucket:"mtosmana.firebasestorage.app",messagingSenderId:"77387574915",appId:"1:77387574915:web:7b6855e73ec15269d935b6",measurementId:"G-110ZTYS339"}),c=(0,n.aU)(o);(0,s.c7)(o);(0,i.TT)().then(e=>{e&&(0,i.P5)(o)})},9323:(e,a,t)=>{"use strict";t.d(a,{$u:()=>h,dT:()=>f,r1:()=>g});var r=t(9980),n=t(6104),s=t(5317);let i=async e=>await r.Ay.hash(e,12),o=async(e,a)=>await r.Ay.compare(e,a),c=e=>/^[a-zA-Z0-9_-]{3,50}$/.test(e),l=e=>e.length>=6,u=async()=>{try{let e=(0,s.rJ)(n.db,"test");return await (0,s.GG)(e),!0}catch(e){return console.warn("Firebase not accessible:",e),!1}},d=async e=>{let{username:a,password:t}=e;return"admin"===a&&"admin123"===t?{id:"demo-admin-id",username:"admin",role:"admin"}:"exchange1"===a&&"exchange123"===t?{id:"demo-exchange-id",username:"exchange1",role:"exchange",exchangeName:"Demo Exchange Office"}:null},m=async e=>{try{var a,t;let r,i=(0,s.rJ)(n.db,"users"),o=(0,s.P)(i,(0,s._M)("username","==",e)),c=await (0,s.GG)(o);if(c.empty)return null;let l=c.docs[0],u=l.data();return r=u.commissionRates?"number"==typeof u.commissionRates.incoming?{incoming:{type:"fixed",value:u.commissionRates.incoming},outgoing:{type:"fixed",value:u.commissionRates.outgoing}}:u.commissionRates:{incoming:{type:"fixed",value:0},outgoing:{type:"fixed",value:0}},{id:l.id,username:u.username,password:u.password,role:u.role,exchangeName:u.exchangeName,contactInfo:u.contactInfo,balance:u.balance||0,commissionRates:r,assignedBanks:u.assignedBanks||[],status:u.status||"active",createdAt:(null==(a=u.createdAt)?void 0:a.toDate())||new Date,updatedAt:(null==(t=u.updatedAt)?void 0:t.toDate())||new Date}}catch(e){return console.error("Error finding user:",e),null}},g=async()=>{try{if(!await u())return console.log("Firebase not accessible, skipping admin creation"),!0;if(await m("admin"))return!0;let e=await i("admin123"),a={username:"admin",password:e,role:"admin",balance:0,commissionRates:{incoming:{type:"fixed",value:0},outgoing:{type:"fixed",value:0}},assignedBanks:[],status:"active",createdAt:s.Dc.now(),updatedAt:s.Dc.now()};return await (0,s.gS)((0,s.rJ)(n.db,"users"),a),console.log("Default admin user created"),!0}catch(e){return console.error("Error creating default admin:",e),!0}},h=async e=>{try{let{username:a,password:t}=e;if(!c(a)||!l(t))return null;if(!await u())return console.warn("Firebase not accessible, using fallback authentication"),await d(e);let r=await m(a);if(!r||"active"!==r.status||!await o(t,r.password))return null;return{id:r.id,username:r.username,role:r.role,exchangeName:r.exchangeName}}catch(a){return console.error("Authentication error:",a),console.warn("Falling back to demo authentication"),await d(e)}},f=async e=>{try{if(!await u())return console.warn("Firebase not accessible, cannot create exchange user"),!1;if(!c(e.username)||!l(e.password)||await m(e.username))return!1;let a=await i(e.password),t={username:e.username,password:a,role:"exchange",exchangeName:e.exchangeName,balance:e.balance||0,commissionRates:e.commissionRates||{incoming:{type:"fixed",value:0},outgoing:{type:"fixed",value:0}},assignedBanks:[],status:"active",createdAt:s.Dc.now(),updatedAt:s.Dc.now()};return await (0,s.gS)((0,s.rJ)(n.db,"users"),t),!0}catch(e){return console.error("Error creating exchange user:",e),!1}}},9825:()=>{}},e=>{var a=a=>e(e.s=a);e.O(0,[992,865,441,684,358],()=>a(2261)),_N_E=e.O()}]);