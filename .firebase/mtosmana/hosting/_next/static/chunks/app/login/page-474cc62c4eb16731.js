(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{283:(e,a,r)=>{"use strict";r.d(a,{A:()=>i,AuthProvider:()=>l,N:()=>c});var t=r(5155),s=r(2115),n=r(9323);let o=(0,s.createContext)(void 0),i=()=>{let e=(0,s.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/login",a=i();return(0,s.useEffect)(()=>{a.loading||a.user||(window.location.href=e)},[a.loading,a.user,e]),a},l=e=>{let{children:a}=e,[r,i]=(0,s.useState)(null),[c,l]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=async()=>{try{await (0,n.r1)()}catch(e){console.error("Error initializing app:",e)}},a=async()=>{try{let e=localStorage.getItem("auth_user");if(e){let a=JSON.parse(e);a.id&&a.username&&a.role?i(a):localStorage.removeItem("auth_user")}}catch(e){console.error("Error checking auth:",e),localStorage.removeItem("auth_user")}finally{l(!1)}};(async()=>{await e(),await a()})()},[]);let d=async e=>{try{l(!0);let a=await (0,n.$u)(e);if(a)return i(a),localStorage.setItem("auth_user",JSON.stringify(a)),!0;return!1}catch(e){return console.error("Login error:",e),localStorage.removeItem("auth_user"),i(null),!1}finally{l(!1)}},u=async()=>{try{i(null),localStorage.removeItem("auth_user")}catch(e){console.error("Logout error:",e)}};return(0,t.jsx)(o.Provider,{value:{user:r,loading:c,login:d,logout:u},children:a})}},4325:(e,a,r)=>{"use strict";r.d(a,{default:()=>o});var t=r(5155),s=r(2115),n=r(283);function o(){let{login:e,loading:a}=(0,n.A)(),[r,o]=(0,s.useState)({username:"",password:""}),[i,c]=(0,s.useState)(""),[l,d]=(0,s.useState)(!1),u=e=>{let{name:a,value:r}=e.target;o(e=>({...e,[a]:r})),c("")},m=async a=>{if(a.preventDefault(),c(""),d(!0),!r.username.trim()){c("Username is required"),d(!1);return}if(!r.password){c("Password is required"),d(!1);return}try{await e(r)?window.location.href="/dashboard":c("Invalid username or password")}catch(e){console.error("Login error:",e),c("An error occurred during login. Please try again.")}finally{d(!1)}};return a?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,t.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Financial Transfer System"}),(0,t.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Sign in to your account"})]}),(0,t.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:m,children:[(0,t.jsxs)("div",{className:"rounded-md shadow-sm space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),(0,t.jsx)("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,className:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Enter your username",value:r.username,onChange:u,disabled:l})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,t.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Enter your password",value:r.password,onChange:u,disabled:l})]})]}),i&&(0,t.jsx)("div",{className:"rounded-md bg-red-50 p-4",children:(0,t.jsx)("div",{className:"text-sm text-red-800",children:i})}),(0,t.jsx)("div",{children:(0,t.jsx)("button",{type:"submit",disabled:l,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:l?(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Signing in..."]}):"Sign in"})}),(0,t.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-md",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-blue-800 mb-2",children:"Default Credentials:"}),(0,t.jsxs)("p",{className:"text-sm text-blue-700",children:["Username: ",(0,t.jsx)("code",{className:"bg-white px-1 rounded",children:"admin"})]}),(0,t.jsxs)("p",{className:"text-sm text-blue-700",children:["Password: ",(0,t.jsx)("code",{className:"bg-white px-1 rounded",children:"admin123"})]})]})]})]})})}},6104:(e,a,r)=>{"use strict";r.d(a,{db:()=>c});var t=r(3915),s=r(5317),n=r(858),o=r(6864);let i=(0,t.Wp)({apiKey:"AIzaSyDT2ucPBS2vS_YwxEoZd-bDAhXqj9Dz_j8",authDomain:"mtosmana.firebaseapp.com",projectId:"mtosmana",storageBucket:"mtosmana.firebasestorage.app",messagingSenderId:"77387574915",appId:"1:77387574915:web:7b6855e73ec15269d935b6",measurementId:"G-110ZTYS339"}),c=(0,s.aU)(i);(0,n.c7)(i);(0,o.TT)().then(e=>{e&&(0,o.P5)(i)})},8429:(e,a,r)=>{Promise.resolve().then(r.bind(r,4325))},9323:(e,a,r)=>{"use strict";r.d(a,{$u:()=>g,dT:()=>x,r1:()=>h});var t=r(9980),s=r(6104),n=r(5317);let o=async e=>await t.Ay.hash(e,12),i=async(e,a)=>await t.Ay.compare(e,a),c=e=>/^[a-zA-Z0-9_-]{3,50}$/.test(e),l=e=>e.length>=6,d=async()=>{try{let e=(0,n.rJ)(s.db,"test");return await (0,n.GG)(e),!0}catch(e){return console.warn("Firebase not accessible:",e),!1}},u=async e=>{let{username:a,password:r}=e;return"admin"===a&&"admin123"===r?{id:"demo-admin-id",username:"admin",role:"admin"}:"exchange1"===a&&"exchange123"===r?{id:"demo-exchange-id",username:"exchange1",role:"exchange",exchangeName:"Demo Exchange Office"}:null},m=async e=>{try{var a,r;let t=(0,n.rJ)(s.db,"users"),o=(0,n.P)(t,(0,n._M)("username","==",e)),i=await (0,n.GG)(o);if(i.empty)return null;let c=i.docs[0],l=c.data();return{id:c.id,username:l.username,password:l.password,role:l.role,exchangeName:l.exchangeName,contactInfo:l.contactInfo,balance:l.balance||0,commissionRates:l.commissionRates||{incoming:0,outgoing:0},assignedBanks:l.assignedBanks||[],status:l.status||"active",createdAt:(null==(a=l.createdAt)?void 0:a.toDate())||new Date,updatedAt:(null==(r=l.updatedAt)?void 0:r.toDate())||new Date}}catch(e){return console.error("Error finding user:",e),null}},h=async()=>{try{if(!await d())return console.log("Firebase not accessible, skipping admin creation"),!0;if(await m("admin"))return!0;let e=await o("admin123"),a={username:"admin",password:e,role:"admin",balance:0,commissionRates:{incoming:0,outgoing:0},assignedBanks:[],status:"active",createdAt:n.Dc.now(),updatedAt:n.Dc.now()};return await (0,n.gS)((0,n.rJ)(s.db,"users"),a),console.log("Default admin user created"),!0}catch(e){return console.error("Error creating default admin:",e),!0}},g=async e=>{try{let{username:a,password:r}=e;if(!c(a)||!l(r))return null;if(!await d())return console.warn("Firebase not accessible, using fallback authentication"),await u(e);let t=await m(a);if(!t||"active"!==t.status||!await i(r,t.password))return null;return{id:t.id,username:t.username,role:t.role,exchangeName:t.exchangeName}}catch(a){return console.error("Authentication error:",a),console.warn("Falling back to demo authentication"),await u(e)}},x=async e=>{try{if(!await d())return console.warn("Firebase not accessible, cannot create exchange user"),!1;if(!c(e.username)||!l(e.password)||await m(e.username))return!1;let a=await o(e.password),r={username:e.username,password:a,role:"exchange",exchangeName:e.exchangeName,balance:e.balance||0,commissionRates:e.commissionRates||{incoming:0,outgoing:0},assignedBanks:[],status:"active",createdAt:n.Dc.now(),updatedAt:n.Dc.now()};return await (0,n.gS)((0,n.rJ)(s.db,"users"),r),!0}catch(e){return console.error("Error creating exchange user:",e),!1}}},9825:()=>{}},e=>{var a=a=>e(e.s=a);e.O(0,[992,865,441,684,358],()=>a(8429)),_N_E=e.O()}]);